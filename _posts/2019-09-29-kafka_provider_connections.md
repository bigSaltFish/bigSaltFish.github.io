---
layout: default
title: kafka是如何支撑百万连接的？
#excerpt: 
---

　　 kafka使用了reactor多路复用机制   

　　 传统的机制，一个连接一个线程：当连接的数量很大，对应的处理线程数量也很大，服务器必然不堪重负。如果有一万个连接，那就对应有一万个线程去处理。    

　　 reactor机制：   

　　 　　 1.由一个acceptor线程，监听连接的建立，连接建立后，投递给process线程；  

　　 　　 2.process线程，会有多个，每个process线程对应某些连接（类似于数据库中，对id取膜的方式分表）；  

　　 　　 3.process线程接收到连接，统一投递到“请求队列”中，等待处理；  

　　 　　 4.真正处理的线程池，会去主动消费“请求队列”，消费完毕，会把响应丢到“响应队列”中；   

　　 　　 5.最终，process会从自己的“响应队列”中拿到自己的响应发送回客户端。   

　　 如果还是有一万个连接，使用了reactor机制，只需要1个acceptor线程+10个process线程+100个线程（线程池中处理的线程，步骤4）。线程数会从一万骤降到百这个级别。





　　 总结：kafka的reactor机制，省了线程数，连接数是不变的。