---
layout: default
title: csv up issue
#excerpt: 

---

#  故事背景

   因为一系列复杂的原因，最近升级频繁发生事故，大家都想尽力避免出错，然而，今天还是出现在我的功能升级上面，事故影响大，开贴记录，希望能够改掉老毛病

#  排查过程

   首先是客服反馈拨打电话无法正常工作，截图发到故障群，是无法提交通话备注。先入为主的给我一种错觉，是提交备注那里改出了问题，然而，uat环境是正常的，这让我无法解释是本次修改出的bug。业务催的急，领导关注，短时间无法定位问题，只能回滚版本，然而，回滚了，仍然功能异常，因为这部分功能高度依赖js，推测是浏览器缓存的问题，让客服清浏览器缓存，清除后，仍然无效。正在卡壳的时候，运维那边发力了，也回滚了配置，配置回滚后，客服反馈一切正常。

   到这里，基本清晰了，是配置的问题。但当时的我，不是清醒状态，没有明确是配置的问题，依旧以为是代码问题，然后一点点看日志，试图找到更加精准的信息。方向错了，多走了好多弯路。弯路走完了，终于还是定位到了问题原因，原因也很无语，测试提供给运维的配置，是之前升级过的配置，而且多了一个空格，如果仅仅是重复加了一次配置，也是不会出问题的，问题出在重复的配置后面有空格，导致aes的加密失败  【IV must be 16 bytes long】

# 总结

   这件事，多个角色都存在问题：开发没有仔细核对配置，配置有疑问，也没重视，开发这里是源头，占有绝大部分责任；测试也有责任，测试甲uat环境升级正常，中途将近一个月，升级的前一天又交接给测试乙（没有仔细交代），升级单里还莫名其妙的带上了空格；运维人员也有一部分责任，纯复制粘贴，没有检查配置是否重复，没有检查是否后缀有空格。

   具体到个人的层面，存在诸多问题

## 问题一 暴露的错误提示不明确

   根本问题是配置错误，导致拨打电话失败，进而导致客服反馈备注保存失败。在拨打电话失败的情况下，没有明确的告诉客服是拨打失败，没有告诉客服失败原因。后续一定要在代码里，返回成功/失败的明确信息，明确的提示，出现问题才能减少干扰，明确目标！

## 问题二  核对配置不上心

   对核对配置不重视，以为UAT环境是ok的，运营就一定ok，核对配置，草草了事，有疑问也不重视；因为时间跨度超过一个月，记忆不清。后续一定要从流程上，减少配置出错的情况，复用sql脚本的思路，配置文件的变更，也必须提交到git，不要在群里发消息，时间长了聊天记录太多，容易出错。